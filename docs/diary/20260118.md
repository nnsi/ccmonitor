# 2026-01-18 10:02 JST

## 今日やったこと

ccmonitor（Claude Code並列稼働WebUI）の設計・計画フェーズ。ユーザーにインタビューしながら要件を詰めていった。

## 技術調査

node-pty + xterm.js の組み合わせでブラウザからターミナルを操作できることを確認。VSCode、Azure Cloud Shell、Hyperなど実績のある組み合わせ。Windows ConPTY APIもサポートされていて、Windows対応も問題なさそう。

Claude Code hooksの調査も行った。`Notification`イベント（idle_prompt, permission_prompt）と`Stop`イベントを使えば、セッション完了や入力待ちを検知できる。これはパターンマッチングに頼らない公式の仕組みなので信頼性が高い。

## 決定事項

- **UI**: タイル形式、最大6個同時表示
- **技術スタック**: Hono + React + Vite + Tailwind + Tanstack Router/Query + Vitest
- **構成**: pnpm モノレポ
- **セッション特定**: CWDで特定（hooks通知にCWD含める）
- **将来**: Electron/Tauriでデスクトップアプリ化も視野

## 感想

インタビュー形式で要件を詰めていくのは良いアプローチだった。ユーザーも「ざっくりしたイメージしかない」と言っていたので、選択肢を提示しながら一緒に固めていけた。

技術選定について、ユーザーがHono、Tanstack Router/Queryを提案してきたのは良い選択だと思う。Expressより軽量でモダン、Tanstack系は型安全で拡張性が高い。自分からは提案しなかったが、ユーザーの判断に賛同できる。

## 反省点

スキルの`node ./scripts/get-date.js`のパス解釈を間違えた。スキルのベースディレクトリからの相対パスだと思い込んでいたが、プロジェクトルートからだった。スキルの記述をもう少し注意深く読むべきだった。

## 次回

Phase 1.1（プロジェクトセットアップ）から実装開始。pnpm workspace初期化、各パッケージのセットアップ。

---

# 2026-01-18 10:46 JST

## 今日やったこと（続き）

Phase 1.1〜1.3を一気に実装し、動作確認まで完了した。

### Phase 1.1: プロジェクトセットアップ
- pnpm workspace構成
- packages/shared（共通型定義）
- packages/server（Hono + node-pty + WebSocket）
- packages/client（React + Vite + Tailwind + xterm.js）

### Phase 1.2-1.3: バックエンド・フロントエンド実装
サブエージェントを並列で使って効率的に実装できた。バックエンドとフロントエンドを同時に作成させ、メインコンテキストを節約できた。

## 動作確認で発見したバグ

Playwright MCPで動作確認したところ、ターミナル出力が表示されない問題があった。

**原因1: subscribeメッセージの未送信**
- クライアントがセッション作成後にsubscribeを送っていなかった
- サーバーはsubscribeしたクライアントにのみデータを配信する設計
- SessionGridでセッション追加時にsubscribeを送るよう修正

**原因2: メッセージタイプの不一致**
- サーバー: `session:data`
- クライアント: `output` を期待
- クライアント側を`session:data`に修正

これらは私（サブエージェント）が作成したコードの連携ミス。サブエージェントに詳細な仕様を渡したつもりだったが、subscribeの自動送信とメッセージタイプの統一が抜けていた。

## 感想

サブエージェントを使った並列実装は効率的だったが、コンポーネント間の連携部分でバグが出やすい。特にWebSocketのプロトコル（メッセージタイプ、subscribeの仕組み）はサーバーとクライアントで一貫性を持たせる必要がある。

次回からは：
1. 共通の型定義（packages/shared）にWebSocketメッセージ型を先に定義
2. サブエージェントにその型を参照させる
3. subscribe/unsubscribeのフローを明示的に指示

Playwrightでの動作確認は非常に有用だった。実際にブラウザを操作して、UIの動作とターミナル出力を視覚的に確認できた。

## 修正後の動作確認結果

Claude Codeが正常に起動し、ターミナル入力も動作した。セキュリティプロンプトで「Yes, I trust this folder」を選択する操作も問題なく行えた。

## 次回

Phase 2（ブラウザ通知、セッション履歴）に進むか、ユーザーの判断を待つ。
